services:
  # 1. Frontend: The Dashboard
  frontend:
    build:
      context: ..
      dockerfile: docker/Dockerfile.frontend
    ports:
      - "5173:5173"
    volumes:
      - ../aegis-frontend/src:/app/src
    restart: always

  # 2. Auth: The Python Server
  auth:
    build:
      context: ..
      dockerfile: docker/Dockerfile.auth
    ports:
      - "5000:5000"
    volumes:
      - ../keys:/app/keys
      - ../app.py:/app/app.py
      - ../jwt_generator.py:/app/jwt_generator.py
    environment:
      - FLASK_ENV=development
    restart: always

  # 3. Proxy: The Supabase Connection
  proxy:
    build:
      context: ..
      dockerfile: docker/Dockerfile.proxy
    ports:
      - "3001:3001"
    # CHANGED: Now looking for .env.local explicitly
    env_file:
      - ../.env.local
    environment:
      - PORT=3001
    restart: always
